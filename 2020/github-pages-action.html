<!DOCTYPE html>
<html lang="en">


  




  



  


<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Use GitHub Actions to generate builds for GitHub Pages">
  <meta name="keywords" content="programming, software, engineer, engineering, frontend, javascript, code, technology, tech, umang, galaiya, umanghome, blog, github, pages, actions, build, gh-pages">
  <meta name="author" content="Using GitHub Actions to build GitHub Pages / Umang's Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Using GitHub Actions to build GitHub Pages / Umang's Blog">
  <meta name="twitter:description" content="Use GitHub Actions to generate builds for GitHub Pages">
  <meta name="twitter:image" content="https://umanggalaiya.in/blog/img/umang.jpg">

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="https://umanggalaiya.in/blog/2020/github-pages-action.html">
  <meta property="og:title" content="Using GitHub Actions to build GitHub Pages / Umang's Blog">
  <meta property="og:description" content="Use GitHub Actions to generate builds for GitHub Pages">
  <meta property="og:image" content="https://umanggalaiya.in/blog/img/umang.jpg">
  <title>Using GitHub Actions to build GitHub Pages / Umang's Blog</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="https://umanggalaiya.in/blog/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://umanggalaiya.in/blog/css/main.css">

  <link rel="canonical" href="https://umanggalaiya.in/blog/2020/github-pages-action.html">
  <link rel="alternate" type="application/rss+xml" title="Umang's Blog" href="https://umanggalaiya.in/blog/feed.xml" />

  <!-- Icons -->
  <link rel="shortcut icon" href="https://umanggalaiya.in/blog/img/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
         

<div class="cover-card table-cell table-middle">
  
  <img src="https://umanggalaiya.in/blog/img/umang.jpg" alt="" class="avatar">
  
  <a href="https://umanggalaiya.in/blog/" class="author_name">Umang Galaiya</a>
  <span class="author_job">Frontend Engineer at Razorpay</span>
  <span class="author_bio mbm">HCI and Technology nerd</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="https://umanggalaiya.in/blog/">home</a>
      </li>
      
      <li class="nav-item">
        <span>/</span>
        <a href="https://umanggalaiya.in/">portfolio</a>
      </li>
    </ul>
  </nav>
  <div class="social-links">
  <ul>
    
      <li>
        <a title="Email" href="mailto:umang@umanggalaiya.in" class="social-link-item" target="_blank" rel="noopener"><i class="fa fa-fw fa-envelope"></i></a>
      </li>
    
    <li><a title="Twitter" href="http://twitter.com/umanghome" class="social-link-item" target="_blank" rel="noopener"><i class="fa fa-fw fa-twitter"></i></a></li>
    <li><a title="Facebook" href="http://facebook.com/umanghome" class="social-link-item" target="_blank" rel="noopener"><i class="fa fa-fw fa-facebook"></i></a></li>
    
    <li><a title="LinkedIn" href="http://linkedin.com/in/umanggalaiya" class="social-link-item" target="_blank" rel="noopener"><i class="fa fa-fw fa-linkedin"></i></a></li>
    <li><a title="Instagram" href="http://instagram.com/umanghome" class="social-link-item" target="_blank" rel="noopener"><i class="fa fa-fw fa-instagram"></i></a></li>
    <li><a title="GitHub" href="http://github.com/umanghome" class="social-link-item" target="_blank" rel="noopener"><i class="fa fa-fw fa-github"></i></a></li>
    <li><a title="Stack Overflow" href="http://stackoverflow.com/users/4176188/umang-galaiya" class="social-link-item" target="_blank" rel="noopener"><i class="fa fa-fw fa-stack-overflow"></i></a></li>
    
    
    
    
    
    
    
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        
<a class="btn" href= "https://umanggalaiya.in/blog/" >
  Home
</a>



<div id="post">
  <header class="post-header">
    <h1 title="Using GitHub Actions to build GitHub Pages">Using GitHub Actions to build GitHub Pages</h1>
    <span class="post-meta">
      <span class="post-date">
        10 AUG 2020
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    1 min read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <p>Use GitHub Actions to generate builds for GitHub Pages</p>

    <p>I like <a href="https://pages.github.com/">GitHub Pages</a> a lot. For someone who does not have a file server, GitHub Pages is godsend. If you don't know what GitHub Pages is — you put some static files in your repository and GitHub will serve them for you. Works great for shipping websites. GitHub Pages gives you HTTPS out-of-the-box too, so that's one less thing to worry about.</p>
<p>Every time you create a new repository and <a href="https://docs.github.com/en/github/working-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site">set up GitHub Pages</a> for it, you get a URL that is of the format <code>https://{username}.github.io/{repository}</code>. I like this a lot because it ties my repository and username together. You can also set up a custom domain and have things hosted at <code>https://{yourdomain}/{repository}</code> - all without needing a file server. Neat.</p>
<p>At the time of this writing, there is one constraint on setting up GitHub Pages: You can only serve files from the root directory (<code>/</code>) or a <code>/docs</code> directory. Which is a bummer if you use a library to generate your static files, your build typically lives in a <code>/build</code> or <code>/public</code> directory.</p>
<p>You can, however, tell GitHub Pages to pick files from a specific branch. You can leverage this and possibly put your build in a branch named <code>gh-pages</code> or <code>build</code> in the root directory. Then configure your repository to use that branch as the source for the GitHub page, and you're set. If you do this manually, the steps kind of look like this:</p>
<ol>
<li><code>npm run build</code></li>
<li><code>cd build</code></li>
<li><code>git init</code></li>
<li><code>git remote add origin https://github.com/{username}/{repository}.git</code></li>
<li><code>git checkout build</code></li>
<li><code>git add .</code></li>
<li><code>git commit -m {message}</code></li>
<li><code>git push origin build</code></li>
</ol>
<p>That's ... quite a bit.</p>
<h2>What about Vercel/Netlify/X?</h2>
<p>These services let you set up something similar. Most of the times you won't even need to add a configuration to your repo. Click some buttons on their website, and you will have a working URL where your project is hosted. You might even get preview builds for all of your branches as an added bonus, which is pretty useful.</p>
<p>But I, personally, do not prefer to go use a third-party service to do this for me if GitHub does the job just fine. If I need preview builds or if I need something that's not just serving static files, I might use one of these services. For most projects, though, GitHub Pages serves the purpose.</p>
<h2>GitHub Actions</h2>
<p><a href="https://github.com/features/actions">GitHub Actions</a> lets you add workflows to your project/repository. In simpler terms, you can trigger <em>actions</em> on events. An example would be &quot;when something is pushed to the <code>master</code> branch, generate a build and push it to a <code>build</code> branch&quot; - which is exactly what we are trying to do. You can create complex workflows too, but let's just talk about what we need right now.</p>
<h2>Generate and serve assets for GitHub Pages using GitHub Actions</h2>
<p>If you use a <a href="https://github.com/facebook/create-react-app">create-react-app</a> template, a <a href="https://github.com/sveltejs/template">Svelte template</a>, or any template in your framework/library of choice, you probably have a <code>build</code> command. This command generates the static assets for your: HTML, CSS, JavaScript, images, etc. The generated assets are placed in a folder: <code>/public</code>, <code>/build</code>, or whatever. You want to serve this directory using GitHub pages. Your choices are:</p>
<ol>
<li>Make sure your build is in the <code>/docs</code> directory. This will need some changes in the build process and is completely doable. You can then use the <code>master</code> branch as your GitHub Pages branch.</li>
<li>Make sure your build is in the root (<code>/</code>) directory. This will need changes in the build process too. And it makes the root directory very cluttered. Would not recommend.</li>
<li>Have another branch (for example, <code>build</code>) that contains the assets in the root directory. Use the <code>build</code> branch as your GitHub Pages branch.</li>
</ol>
<p>I like the last option a lot. It keeps my <code>master</code> branch clean. I don't have to use a <code>/docs</code> directory, whose name is misleading because it does not necessarily contain my project's documentation.</p>
<p>GitHub Actions is the perfect way to automate this. We can create a workflow that, on every push to <code>master</code>, runs a command to generate a build and then pushes files from the build directory to another branch. The workflow looks like this and lives in the <strong><code>.github/workflows/publish.yml</code></strong> file:</p>
<script src="https://gist.github.com/umanghome/30527c68cd605dfef8702a832ff14fd5.js"></script>
<p>Let's take a closer view at some relevant parts:</p>
<pre class="language-yml"><code class="language-yml"><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> master</code></pre>
<p>This bit tells GitHub Actions to run this workflow when something is pushed to the <code>master</code> branch.</p>
<pre class="language-yml"><code class="language-yml"><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">name</span><span class="token punctuation">:</span> Build and Push</code></pre>
<p>This bit specifies the <code>build</code> job that we are defining. It will run on an Ubuntu OS. There are more options available <a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idruns-on">in the docs</a> - you can pick something else if your project requires it.</p>
<pre class="language-yml"><code class="language-yml"><span class="token key atrule">steps</span><span class="token punctuation">:</span><br>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>checkout<br>    <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br><br>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install all dependencies<br>    <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install<br><br>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build<br>    <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build <span class="token comment"># The build command of your project</span></code></pre>
<p>These steps do the following things, in order: Checkout your repo+branch, run <code>npm install</code>, and then run <code>npm run build</code>. If your build command is something else, make sure you modify the line.</p>
<pre class="language-yml"><code class="language-yml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push<br>  <span class="token key atrule">uses</span><span class="token punctuation">:</span> s0/git<span class="token punctuation">-</span>publish<span class="token punctuation">-</span>subdir<span class="token punctuation">-</span>action@develop<br>  <span class="token key atrule">env</span><span class="token punctuation">:</span><br>    <span class="token key atrule">REPO</span><span class="token punctuation">:</span> self<br>    <span class="token key atrule">BRANCH</span><span class="token punctuation">:</span> build <span class="token comment"># The directory where your assets are generated</span><br>    <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span> build <span class="token comment"># The branch name where you want to push the assets</span><br>    <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $ <span class="token comment"># GitHub will automatically add this - you don't need to bother getting a token</span><br>    <span class="token key atrule">MESSAGE</span><span class="token punctuation">:</span> <span class="token key atrule">"Build</span><span class="token punctuation">:</span> (<span class="token punctuation">{</span>sha<span class="token punctuation">}</span>) <span class="token punctuation">{</span>msg<span class="token punctuation">}</span>" <span class="token comment"># The commit message</span></code></pre>
<p>This step is interesting. We are using another action: <a href="https://github.com/s0/git-publish-subdir-action">s0/git-publish-subdir-action</a>. This action pushes the directory we specify to a branch we specify. In this case, it pushes the <code>build</code> directory to the <code>build</code> branch. It's worthwhile looking at the documentation of this action to understand the other configuration options it provides.</p>
<p>That's it. Once this workflow is active (which it will be as soon as you push the <code>publish.yml</code> file), all pushes to <code>master</code> will lead to their corresponding builds to be pushed to the <code>build</code> branch. You can configure your repository to pick the <code>build</code> branch's root (<code>/</code>) directory as the source of your GitHub Pages.</p>
<p>I'm going to start using it in most projects I make that output static files.</p>

  </article>
</div>

<div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=https://umanggalaiya.in/blog/2020/github-pages-action.html" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://umanggalaiya.in/blog/2020/github-pages-action.html" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=https://umanggalaiya.in/blog/2020/github-pages-action.html" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=https://umanggalaiya.in/blog/2020/github-pages-action.html" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div><!-- end share-buttons -->

        <footer>
  &copy; 2020 Umang Galaiya. Powered by <a href="https://www.11ty.dev/">11ty (Eleventy)</a>, <a href="http://github.com/renyuanz/leonids/">leonids theme</a> made with <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
</body>
</html>
